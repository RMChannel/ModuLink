<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Gestione Ruoli - ModuLink</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/user/colors.css}">
    <link rel="stylesheet" th:href="@{/css/user/dashboard-layout.css}">
    <link rel="stylesheet" th:href="@{/css/moduli/GDU/gdu.css}">
    <link rel="stylesheet" th:href="@{/css/moduli/GDU/gdu-modals.css}">
    <link rel="stylesheet" th:href="@{/css/common/alerts.css}">
    <script th:src="@{/javascript/theme.js}"></script>
    
    <style>
        /* =========================================
           STRICT THEME ADHERENCE
           ========================================= */
        body { background-color: var(--bg-body); color: var(--text-body); }
        h1, h2, h3, h4, h5, h6 { color: var(--text-heading); }
        
        /* LIST ITEM THEME */
        .role-list-item {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem; /* Rounded corners for list items */
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .role-list-item:hover {
            border-color: var(--border-color-hover);
            box-shadow: var(--shadow-card);
            transform: translateX(4px); /* Subtle interaction */
        }

        /* COLOR INDICATOR STRIP */
        .role-color-strip {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
        }

        /* TEXT UTILITIES */
        .text-theme-heading { color: var(--text-heading) !important; }
        .text-theme-body { color: var(--text-body) !important; }
        .text-theme-muted { color: var(--text-muted) !important; }
        .text-theme-secondary { color: var(--text-secondary) !important; }

        /* BUTTONS */
        .btn-theme-primary {
            background-color: var(--color-primary);
            color: var(--color-white);
            border: none;
            box-shadow: var(--shadow-btn-primary);
            padding: 0.5rem 1.25rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .btn-theme-primary:hover {
            background-color: var(--color-primary-dark);
            color: var(--color-white);
        }

        .btn-icon-theme {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        .btn-icon-theme:hover {
            background-color: var(--bg-body-alt);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }
        .btn-icon-theme.danger:hover {
            color: var(--text-danger);
            border-color: var(--text-danger);
            background-color: var(--bg-alert-danger);
        }
        .btn-icon-theme.info:hover {
            color: var(--color-primary-lighter);
            border-color: var(--color-primary-lighter);
            background-color: var(--color-primary-light);
        }

        /* INPUTS */
        .form-control-theme {
            background-color: var(--bg-input);
            color: var(--text-body);
            border: 1px solid var(--border-color);
        }
        .form-control-theme:focus {
            background-color: var(--bg-input-focus);
            border-color: var(--border-focus);
            box-shadow: var(--shadow-input-focus);
            color: var(--text-body);
        }
        .form-control-theme::placeholder {
            color: var(--text-placeholder);
        }
        
        .form-control-color-theme {
            width: 100%;
            height: 38px;
            padding: 0.375rem;
            background-color: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
        }

        /* MODALS */
        .modal-content-theme { background-color: var(--bg-light); border: 1px solid var(--border-color); }
        .modal-header-theme { border-bottom: 1px solid var(--border-color); padding: 1.5rem; }
        .modal-body-theme { padding: 1.5rem; }
        .modal-footer-theme { border-top: 1px solid var(--border-color); padding: 1rem 1.5rem; }

        /* EMPTY STATE */
        .empty-state-box {
            background-color: var(--bg-module-card);
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            padding: 3rem 1rem;
            text-align: center;
        }
        
        /* List Headers (Desktop Only) */
        .list-header {
            padding: 0 1rem 0.5rem 1.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
<div class="dashboard-wrapper">
    <!-- Sidebar Fragment -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    
    <!-- Alerts Fragment -->
    <div th:replace="~{fragments/messages :: alerts}"></div>

    <!-- Validation Error Alert Pop-up -->
    <div th:if="${#fields.hasErrors('newRoleForm.*')}" class="floating-alert-container">
        <div class="floating-alert alert-danger" role="alert">
            <div class="floating-alert-icon">
                <i class="bi bi-exclamation-circle-fill"></i>
            </div>
            <div class="floating-alert-content">
                <span>Si sono verificati errori nella validazione del nuovo ruolo.</span>
            </div>
            <button type="button" class="floating-alert-close" onclick="this.parentElement.remove()" aria-label="Close">
                <i class="bi bi-x"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="content">
        <div class="container-fluid px-3 px-md-4">
            
            <!-- Page Header -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-5 pt-md-4 pb-4 mb-4 border-bottom" style="border-color: var(--border-color) !important;">
                <div class="mb-3 mb-md-0 me-auto">
                    <h1 class="h2 fw-bold text-theme-heading mb-0">Gestione Ruoli</h1>
                    <p class="text-theme-muted mb-0 small mt-1">Configura i ruoli e i permessi aziendali</p>
                </div>
                
                <div class="d-flex flex-column flex-md-row gap-3 w-100 w-md-auto align-items-stretch align-items-md-center">
                    <!-- Search Bar -->
                    <div class="input-group" style="min-width: 250px;">
                        <span class="input-group-text border-0 ps-3" style="background-color: var(--bg-input); border: 1px solid var(--border-color) !important; border-right: none !important; border-radius: 0.5rem 0 0 0.5rem;">
                            <i class="bi bi-search text-theme-muted"></i>
                        </span>
                        <input type="text" class="form-control form-control-theme border-start-0 ps-0" id="roleSearchInput" placeholder="Cerca ruolo per nome..." autocomplete="off">
                    </div>
                    
                    <button type="button" class="btn btn-theme-primary d-flex align-items-center justify-content-center text-nowrap" data-bs-toggle="modal" data-bs-target="#addRoleModal">
                        <i class="bi bi-plus-circle-fill me-2"></i> Nuovo Ruolo
                    </button>
                </div>
            </div>

            <!-- List View Container -->
            <div id="roleListContainer" th:unless="${#lists.isEmpty(ruoli)}">
                <!-- Headers (Visible only on Desktop) -->
                <div class="row list-header d-none d-md-flex">
                    <div class="col-md-4">Nome Ruolo</div>
                    <div class="col-md-5">Descrizione</div>
                    <div class="col-md-3 text-end">Azioni</div>
                </div>

                <!-- List Items Loop -->
                <div class="d-flex flex-column gap-3 mb-5">
                    <div th:each="ruolo : ${ruoli}" class="role-list-item p-3 ps-4">
                        <!-- Color Strip Indicator -->
                        <div class="role-color-strip" th:style="'background-color: ' + ${ruolo.colore} + ';'"></div>
                        
                        <div class="row align-items-center gy-2">
                            
                            <!-- Identity Column -->
                            <div class="col-12 col-md-4 d-flex align-items-center">
                                <div class="d-flex flex-column">
                                    <h5 class="fw-bold text-theme-heading mb-0 role-name" th:text="${ruolo.nome}">Admin</h5>
                                    <div class="d-flex align-items-center small text-theme-secondary mt-1">
                                        <div class="rounded-circle me-2" th:style="'width: 8px; height: 8px; background-color: ' + ${ruolo.colore} + ';'"></div>
                                        <span class="text-uppercase" style="font-size: 0.75rem;" th:text="${ruolo.colore}">#000000</span>
                                        <span class="mx-2 text-theme-muted">•</span>
                                        <span class="text-theme-muted" style="font-size: 0.75rem;">ID: <span th:text="${ruolo.id_ruolo}">1</span></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Description Column -->
                            <div class="col-12 col-md-5">
                                <p class="text-theme-body small mb-0 text-truncate" th:title="${ruolo.descrizione}" th:text="${ruolo.descrizione}">Descrizione ruolo...</p>
                            </div>

                            <!-- Actions Column -->
                            <div class="col-12 col-md-3">
                                <div class="d-flex justify-content-md-end justify-content-start gap-2 pt-2 pt-md-0">
                                    <!-- Assign Users -->
                                    <button class="btn-icon-theme info" title="Assegna Utenti"
                                            th:data-id="${ruolo.id_ruolo}"
                                            th:data-nome="${ruolo.nome}"
                                            th:data-assigned-users="${ruolo.associazioni.![id_utente]}"
                                            onclick="openAssignModal(this)">
                                        <i class="bi bi-people-fill"></i>
                                    </button>
                                    <!-- Modify -->
                                    <button class="btn-icon-theme" title="Modifica"
                                            th:data-id="${ruolo.id_ruolo}"
                                            th:data-nome="${ruolo.nome}"
                                            th:data-colore="${ruolo.colore}"
                                            th:data-descrizione="${ruolo.descrizione}"
                                            onclick="openModifyRoleModal(this)">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                    <!-- Delete -->
                                    <button class="btn-icon-theme danger" title="Elimina"
                                            th:data-id="${ruolo.id_ruolo}"
                                            th:data-nome="${ruolo.nome}"
                                            onclick="openDeleteRoleModal(this)">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State (Default) -->
            <div id="defaultEmptyState" th:if="${#lists.isEmpty(ruoli)}" class="empty-state-box mb-5">
                <i class="bi bi-shield-lock display-4 text-theme-muted opacity-50 mb-3 d-block"></i>
                <h5 class="text-theme-heading">Nessun ruolo trovato</h5>
                <p class="text-theme-muted">Inizia creando i ruoli per definire i permessi degli utenti.</p>
            </div>
            
            <!-- Search Empty State -->
            <div id="searchEmptyState" class="empty-state-box mb-5" style="display: none;">
                <i class="bi bi-search display-4 text-theme-muted opacity-50 mb-3 d-block"></i>
                <h5 class="text-theme-heading">Nessun ruolo trovato</h5>
                <p class="text-theme-muted">Nessun risultato corrisponde alla tua ricerca.</p>
            </div>

        </div>
    </div>
</div>

<!-- Add Role Modal -->
<div class="modal fade" id="addRoleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-theme shadow-lg rounded-4 overflow-hidden">
            <!-- Dynamic Color Strip -->
            <div id="addModalColorStrip" class="position-absolute top-0 start-0 end-0" style="height: 6px; background-color: var(--color-primary); transition: background-color 0.3s ease;"></div>
            
            <form th:action="@{/dashboard/gru/add-role}" th:object="${newRoleForm}" method="post">
                <div class="modal-header modal-header-theme pt-4">
                    <div class="d-flex align-items-center">
                        <div id="addModalIcon" class="btn-icon-theme me-3" style="border-color: var(--color-primary); color: var(--color-primary);">
                            <i class="bi bi-shield-plus"></i>
                        </div>
                        <div>
                            <h5 class="modal-title fw-bold text-theme-heading">Nuovo Ruolo</h5>
                            <p class="text-theme-muted small mb-0">Definisci un nuovo set di permessi</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body modal-body-theme">
                    
                    <!-- Preview Badge -->
                    <div class="mb-4 p-3 rounded-3 d-flex align-items-center justify-content-center" style="background-color: var(--bg-body-alt); border: 1px dashed var(--border-color);">
                        <div class="d-flex flex-column align-items-center">
                            <span class="text-theme-muted small mb-2 uppercase fw-bold" style="font-size: 0.65rem; letter-spacing: 0.05em;">Anteprima Badge</span>
                            <div id="addRolePreviewBadge" class="px-3 py-1 rounded-pill fw-bold shadow-sm" style="background-color: var(--color-primary); color: white; transition: all 0.3s ease;">
                                Nuovo Ruolo
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-12">
                            <label for="addNome" class="form-label fw-medium text-theme-secondary">Nome</label>
                            <input type="text" class="form-control form-control-theme" id="addNome" th:field="*{nome}" 
                                   th:classappend="${#fields.hasErrors('nome')} ? 'is-invalid' : ''" placeholder="Es. Amministratore">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></div>
                        </div>
                        <div class="col-12">
                            <label for="addColore" class="form-label fw-medium text-theme-secondary">Colore</label>
                            <div class="d-flex gap-2 align-items-center">
                                <input type="color" class="form-control form-control-color-theme" id="addColore" th:field="*{colore}" 
                                       th:classappend="${#fields.hasErrors('colore')} ? 'is-invalid' : ''" title="Scegli il colore" style="width: 60px; flex-shrink: 0;">
                                <input type="text" class="form-control form-control-theme flex-grow-1" id="addColoreHex" readonly style="font-family: monospace; font-size: 0.9rem;" value="#634BFF">
                            </div>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('colore')}" th:errors="*{colore}"></div>
                        </div>
                        <div class="col-12">
                            <label for="addDescrizione" class="form-label fw-medium text-theme-secondary">Descrizione</label>
                            <textarea class="form-control form-control-theme" id="addDescrizione" th:field="*{descrizione}" 
                                      th:classappend="${#fields.hasErrors('descrizione')} ? 'is-invalid' : ''" rows="3" placeholder="Descrivi i permessi di questo ruolo..."></textarea>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('descrizione')}" th:errors="*{descrizione}"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer modal-footer-theme">
                    <button type="button" class="btn btn-outline-secondary rounded-pill" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-theme-primary rounded-pill px-4">
                        <i class="bi bi-plus-lg me-1"></i> Crea Ruolo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modify Role Modal -->
<div class="modal fade" id="modifyRoleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-theme shadow-lg rounded-4 overflow-hidden">
            <!-- Dynamic Color Strip at the top of the modal -->
            <div id="modifyModalColorStrip" class="position-absolute top-0 start-0 end-0" style="height: 6px; background-color: var(--color-primary); transition: background-color 0.3s ease;"></div>
            
            <form th:action="@{/dashboard/gru/modify-role}" method="post">
                <div class="modal-header modal-header-theme pt-4">
                    <div class="d-flex align-items-center">
                        <div id="modifyModalIcon" class="btn-icon-theme me-3" style="border-color: var(--color-primary); color: var(--color-primary);">
                            <i class="bi bi-pencil-square"></i>
                        </div>
                        <div>
                            <h5 class="modal-title fw-bold text-theme-heading">Modifica Ruolo</h5>
                            <p class="text-theme-muted small mb-0">Aggiorna le impostazioni del ruolo</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body modal-body-theme">
                    <input type="hidden" id="modifyId" name="idRuolo">
                    
                    <!-- Preview Badge -->
                    <div class="mb-4 p-3 rounded-3 d-flex align-items-center justify-content-center" style="background-color: var(--bg-body-alt); border: 1px dashed var(--border-color);">
                        <div class="d-flex flex-column align-items-center">
                            <span class="text-theme-muted small mb-2 uppercase fw-bold" style="font-size: 0.65rem; letter-spacing: 0.05em;">Anteprima Badge</span>
                            <div id="rolePreviewBadge" class="px-3 py-1 rounded-pill fw-bold shadow-sm" style="background-color: var(--color-primary); color: white; transition: all 0.3s ease;">
                                Ruolo
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-12">
                            <label for="modifyNome" class="form-label fw-medium text-theme-secondary">Nome Ruolo</label>
                            <input type="text" class="form-control form-control-theme" id="modifyNome" name="nome" required placeholder="Es. Manager">
                        </div>
                        <div class="col-12">
                            <label for="modifyColore" class="form-label fw-medium text-theme-secondary">Colore Identificativo</label>
                            <div class="d-flex gap-2 align-items-center">
                                <input type="color" class="form-control form-control-color-theme" id="modifyColore" name="colore" title="Scegli il colore" style="width: 60px; flex-shrink: 0;">
                                <input type="text" class="form-control form-control-theme flex-grow-1" id="modifyColoreHex" readonly style="font-family: monospace; font-size: 0.9rem;">
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="modifyDescrizione" class="form-label fw-medium text-theme-secondary">Descrizione</label>
                            <textarea class="form-control form-control-theme" id="modifyDescrizione" name="descrizione" rows="3" placeholder="Quali sono le responsabilità di questo ruolo?"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer modal-footer-theme">
                    <button type="button" class="btn btn-outline-secondary rounded-pill" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-theme-primary rounded-pill px-4">
                        <i class="bi bi-check-lg me-1"></i> Salva Modifiche
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Role Modal -->
<div class="modal fade" id="deleteRoleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-theme shadow-lg rounded-4">
            <div class="modal-header modal-header-theme">
                <h5 class="modal-title fw-bold text-theme-heading">Elimina Ruolo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-body-theme">
                <p class="text-theme-body">Stai per eliminare il ruolo <strong id="deleteTargetName" class="text-theme-heading"></strong>.</p>
                <div class="alert alert-danger d-flex align-items-center mb-3" role="alert" style="background-color: var(--bg-alert-danger); border-color: var(--border-alert-danger); color: var(--text-danger);">
                    <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
                    <div>Attenzione: Questa azione rimuoverà il ruolo da tutti gli utenti associati.</div>
                </div>
            </div>
            <div class="modal-footer modal-footer-theme">
                <button type="button" class="btn btn-outline-secondary rounded-pill" data-bs-dismiss="modal">Annulla</button>
                <form th:action="@{/dashboard/gru/delete-role}" method="post">
                    <input type="hidden" name="idRuolo" id="deleteIdInput">
                    <button type="submit" class="btn btn-danger rounded-pill px-4 shadow-sm">Elimina Definitivamente</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Assign Users Modal -->
<div class="modal fade" id="assignUsersModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modal-content-theme shadow-lg rounded-4">
            <form th:action="@{/dashboard/gru/assign-role}" method="post">
                <div class="modal-header modal-header-theme">
                    <h5 class="modal-title fw-bold text-theme-heading">Assegna Utenti: <span id="assignRoleName" class="fw-normal"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body modal-body-theme">
                    <input type="hidden" id="assignRoleId" name="idRuolo">
                    <p class="text-theme-muted mb-3">Seleziona gli utenti da associare a questo ruolo.</p>
                    
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 0.5rem;">
                        <table class="table table-hover mb-0" style="background-color: var(--bg-light); color: var(--text-body);">
                            <thead class="sticky-top" style="background-color: var(--bg-body-alt);">
                                <tr>
                                    <th scope="col" style="width: 50px; border-bottom-color: var(--border-color);">
                                        <input class="form-check-input" type="checkbox" id="selectAllUsers">
                                    </th>
                                    <th scope="col" class="text-theme-heading" style="border-bottom-color: var(--border-color);">Nome</th>
                                    <th scope="col" class="text-theme-heading" style="border-bottom-color: var(--border-color);">Email</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user : ${allUsers}" style="border-bottom-color: var(--border-color);">
                                    <td style="border-bottom-color: var(--border-color);">
                                        <input class="form-check-input user-checkbox" type="checkbox" 
                                               name="userIds" 
                                               th:value="${user.id_utente}"
                                               th:id="'user-' + ${user.id_utente}">
                                    </td>
                                    <td style="border-bottom-color: var(--border-color);">
                                        <label th:for="'user-' + ${user.id_utente}" 
                                               th:text="${user.nome + ' ' + user.cognome}" 
                                               style="cursor: pointer; width: 100%; display: block;"
                                               class="text-theme-body"></label>
                                    </td>
                                    <td class="text-theme-muted" th:text="${user.email}" style="border-bottom-color: var(--border-color);"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer modal-footer-theme">
                    <button type="button" class="btn btn-outline-secondary rounded-pill" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-theme-primary rounded-pill px-4">Salva Assegnazioni</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/javascript/gdr.js}"></script>

<!-- Search Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    var searchInput = document.getElementById('roleSearchInput');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            var searchText = this.value.toLowerCase();
            var items = document.querySelectorAll('.role-list-item');
            var visibleCount = 0;
            var searchEmptyState = document.getElementById('searchEmptyState');
            var defaultEmptyState = document.getElementById('defaultEmptyState');

            items.forEach(function(item) {
                var name = item.querySelector('.role-name').textContent.toLowerCase();
                // Filter only by name as requested
                if (name.includes(searchText)) {
                    item.style.display = '';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            if (visibleCount === 0 && searchText.length > 0) {
                if(searchEmptyState) searchEmptyState.style.display = 'block';
                if(defaultEmptyState) defaultEmptyState.style.display = 'none';
            } else {
                if(searchEmptyState) searchEmptyState.style.display = 'none';
            }
        });
    }
});
</script>

<!-- Script to automatically open the modal if there are validation errors -->
<script th:if="${#fields.hasErrors('newRoleForm.*')}">
    document.addEventListener('DOMContentLoaded', function() {
        var addRoleModal = new bootstrap.Modal(document.getElementById('addRoleModal'));
        addRoleModal.show();
    });
</script>

</body>
</html>