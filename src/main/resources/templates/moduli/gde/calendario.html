<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard - Calendario</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/user/colors.css}">
    <link rel="stylesheet" th:href="@{/css/user/dashboard-layout.css}">
    <link rel="stylesheet" th:href="@{/css/moduli/store/store.css}">
    <link rel="stylesheet" th:href="@{/css/common/alerts.css}">
    <link rel="stylesheet" th:href="@{/css/moduli/GDE/calendario.css}">
    <script th:src="@{/javascript/theme.js}"></script>
    <script th:src="@{/javascript/gde/calendario.js}"></script>
</head>
<body>
<div class="dashboard-wrapper">
    <!-- Sidebar Fragment -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    <!-- Alerts Fragment -->
    <div th:replace="~{fragments/messageFromParam :: alertsFromParam}"></div>
    
    <!-- Main Content -->
    <div id="content" class="p-0">
        <div class="calendar-wrapper">
            <div class="calendar-controls">
                <div class="d-flex align-items-center gap-3">
                    <h2 class="m-0">Calendario</h2>
                    <div class="date-navigation btn-group">
                        <button class="btn btn-outline-secondary btn-sm" id="prevPeriod"><i class="bi bi-chevron-left"></i></button>
                        <button class="btn btn-outline-secondary btn-sm" id="todayBtn">Oggi</button>
                        <button class="btn btn-outline-secondary btn-sm" id="nextPeriod"><i class="bi bi-chevron-right"></i></button>
                    </div>
                    <span id="currentPeriodLabel" class="fw-bold fs-5 text-secondary">Gennaio 2026</span>
                </div>

                <div class="d-flex gap-3">
                    <div class="view-selector btn-group">
                        <button class="btn btn-outline-secondary active" data-view="week">Settimana</button>
                        <button class="btn btn-outline-secondary" data-view="month">Mese</button>
                    </div>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createEventModal">
                        <i class="bi bi-plus-lg"></i> Nuovo
                    </button>
                </div>
            </div>

            <!-- Views Container -->
            <div class="calendar-views flex-grow-1 position-relative overflow-hidden">
                <!-- Weekly View (Default) -->
                <div id="weekView" class="calendar-view active h-100 flex-column" style="display:flex;">
                    <div class="week-header d-flex border-bottom">
                        <div class="time-column-header" style="width: 60px;"></div>
                        <!-- Days generated by JS -->
                    </div>
                    <div class="week-body flex-grow-1 overflow-auto position-relative">
                        <div class="time-grid">
                            <!-- Hours generated by JS -->
                        </div>
                        <div class="events-grid position-absolute top-0 start-0 w-100 h-100 pointer-events-none">
                            <!-- Events overlay -->
                        </div>
                    </div>
                </div>

                <!-- Monthly View -->
                <div id="monthView" class="calendar-view h-100 flex-column" style="display:none;">
                    <div class="month-header d-flex border-bottom text-center fw-bold py-2 bg-body">
                        <div class="flex-fill">Lun</div>
                        <div class="flex-fill">Mar</div>
                        <div class="flex-fill">Mer</div>
                        <div class="flex-fill">Gio</div>
                        <div class="flex-fill">Ven</div>
                        <div class="flex-fill">Sab</div>
                        <div class="flex-fill">Dom</div>
                    </div>
                    <div class="month-grid flex-grow-1 d-flex flex-wrap align-content-stretch">
                        <!-- Days generated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Create Event Modal -->
<div class="modal fade" id="createEventModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nuovo Evento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createEventForm">
                    <div class="mb-3">
                        <label class="form-label">Nome Evento</label>
                        <input type="text" class="form-control" name="nome" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Luogo</label>
                        <input type="text" class="form-control" name="luogo">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Inizio</label>
                            <input type="datetime-local" class="form-control" name="inizio" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Fine</label>
                            <input type="datetime-local" class="form-control" name="fine" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Invita Partecipanti</label>
                        <div id="userSelectionList">
                             <div class="text-center text-muted p-2">Caricamento utenti...</div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                <button type="button" class="btn btn-primary" onclick="saveEvent()">Salva</button>
            </div>
        </div>
    </div>
</div>

<!-- Event Details Modal -->
<div class="modal fade" id="eventDetailsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailTitle">Dettagli Evento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <i class="bi bi-clock text-primary"></i> <span id="detailTime"></span>
                </div>
                <div class="mb-2">
                    <i class="bi bi-geo-alt text-danger"></i> <span id="detailPlace"></span>
                </div>
                <input type="hidden" id="detailId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteEvent()">Elimina</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
            </div>
        </div>
    </div>
</div>


<script>

</script>

<script th:inline="javascript">
    /*<![CDATA[*/
    var eventsData = /*[[${eventi}]]*/ [];
    /*]]>*/
</script>

<!-- Bootstrap JavaScript Bundle (include Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>